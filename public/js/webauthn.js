class WebAuthn{constructor(e=null){e&&this.setNotify(e)}register(e,t){var n=this;e.challenge=this._bufferDecode(e.challenge),e.user.id=this._bufferDecode(e.user.id),e.excludeCredentials&&(e.excludeCredentials=e.excludeCredentials.map(function(e){return e.id=n._bufferDecode(e.id),e})),navigator.credentials.create({publicKey:e}).then(e=>{n._registerCallback(e,t)},e=>{n._notify(e.message,!1)})}_registerCallback(e,t){t({id:e.id,type:e.type,rawId:this._bufferEncode(e.rawId),response:{clientDataJSON:this._bufferEncode(e.response.clientDataJSON),attestationObject:this._bufferEncode(e.response.attestationObject)}})}sign(e,t){var n=this;e.challenge=this._bufferDecode(e.challenge),e.allowCredentials=e.allowCredentials.map(function(e){return e.id=n._bufferDecode(e.id),e}),navigator.credentials.get({publicKey:e}).then(e=>{n._signCallback(e,t)},e=>{n._notify(e.message,!1)})}_signCallback(e,t){t({id:e.id,type:e.type,rawId:this._bufferEncode(e.rawId),response:{authenticatorData:this._bufferEncode(e.response.authenticatorData),clientDataJSON:this._bufferEncode(e.response.clientDataJSON),signature:this._bufferEncode(e.response.signature),userHandle:e.response.userHandle?this._bufferEncode(e.response.userHandle):null}})}_bufferEncode(e){return window.btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}_bufferDecode(e){return Uint8Array.from(window.atob(e),e=>e.charCodeAt(0))}webAuthnSupport(){return!(void 0===window.PublicKeyCredential||"function"!=typeof window.PublicKeyCredential||"function"!=typeof window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable)}notSupportedMessage(){return window.isSecureContext||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"webauthn_not_supported":"webauthn_not_secured"}_notify(e,t){this._notifyCallback&&this._notifyCallback(e,t)}setNotify(e){this._notifyCallback=e}}
